{
  "id": 4,
  "type": "timeseries",
  "title": "Temperature, RH & VPD - Main Graph",
  "gridPos": {
    "x": 4,
    "y": 0,
    "h": 24,
    "w": 20
  },
  "fieldConfig": {
    "defaults": {
      "custom": {
        "drawStyle": "line",
        "lineInterpolation": "linear",
        "barAlignment": 0,
        "barWidthFactor": 0.6,
        "lineWidth": 1,
        "fillOpacity": 0,
        "gradientMode": "none",
        "spanNulls": false,
        "insertNulls": false,
        "showPoints": "auto",
        "showValues": false,
        "pointSize": 5,
        "stacking": {
          "mode": "none",
          "group": "A"
        },
        "axisPlacement": "auto",
        "axisLabel": "",
        "axisColorMode": "series",
        "axisBorderShow": true,
        "scaleDistribution": {
          "type": "linear"
        },
        "axisCenteredZero": false,
        "hideFrom": {
          "tooltip": false,
          "viz": false,
          "legend": false
        },
        "thresholdsStyle": {
          "mode": "off"
        },
        "axisSoftMax": 2,
        "axisSoftMin": 15,
        "lineStyle": {
          "fill": "solid"
        }
      },
      "color": {
        "mode": "palette-classic"
      },
      "mappings": [],
      "thresholds": {
        "mode": "absolute",
        "steps": [
          {
            "color": "green",
            "value": null
          },
          {
            "color": "red",
            "value": 80
          }
        ]
      },
      "decimals": 2,
      "fieldMinMax": true,
      "unit": "celsius"
    },
    "overrides": [
      {
        "matcher": {
          "id": "byName",
          "options": "dry_bulb_f"
        },
        "properties": [
          {
            "id": "displayName",
            "value": "Dry Bulb (°C) - Front"
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "wet_bulb_f"
        },
        "properties": [
          {
            "id": "displayName",
            "value": "Wet Bulb (°C) - Front"
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "rh_f"
        },
        "properties": [
          {
            "id": "displayName",
            "value": "RH (%) - Front"
          },
          {
            "id": "unit",
            "value": "percent"
          },
          {
            "id": "decimals",
            "value": 1
          },
          {
            "id": "custom.axisPlacement",
            "value": "right"
          },
          {
            "id": "custom.axisSoftMax",
            "value": 100
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "vpd_f"
        },
        "properties": [
          {
            "id": "displayName",
            "value": "VPD (kPa) - Front"
          },
          {
            "id": "unit",
            "value": "kpa"
          },
          {
            "id": "decimals",
            "value": 2
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "dry_bulb_b"
        },
        "properties": [
          {
            "id": "displayName",
            "value": "Dry Bulb (°C) - Back"
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "wet_bulb_b"
        },
        "properties": [
          {
            "id": "displayName",
            "value": "Wet Bulb (°C) - Back"
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "rh_b"
        },
        "properties": [
          {
            "id": "displayName",
            "value": "RH (%) - Back"
          },
          {
            "id": "unit",
            "value": "percent"
          },
          {
            "id": "decimals",
            "value": 1
          },
          {
            "id": "custom.axisPlacement",
            "value": "right"
          },
          {
            "id": "custom.axisSoftMax",
            "value": 100
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "vpd_b"
        },
        "properties": [
          {
            "id": "displayName",
            "value": "VPD (kPa) - Back"
          },
          {
            "id": "unit",
            "value": "kpa"
          },
          {
            "id": "decimals",
            "value": 2
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "Wet Bulb (°C) - Back"
        },
        "properties": [
          {
            "id": "color",
            "value": {
              "mode": "fixed",
              "fixedColor": "green"
            }
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "Dry Bulb (°C) - Back"
        },
        "properties": [
          {
            "id": "color",
            "value": {
              "mode": "fixed",
              "fixedColor": "orange"
            }
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "Temp Setpoint - Main"
        },
        "properties": [
          {
            "id": "color",
            "value": {
              "mode": "fixed",
              "fixedColor": "red"
            }
          },
          {
            "id": "custom.lineStyle",
            "value": {
              "dash": [10, 10],
              "fill": "dash"
            }
          },
          {
            "id": "custom.lineWidth",
            "value": 2
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "VPD Setpoint - Main"
        },
        "properties": [
          {
            "id": "color",
            "value": {
              "mode": "fixed",
              "fixedColor": "blue"
            }
          },
          {
            "id": "custom.lineStyle",
            "value": {
              "dash": [10, 10],
              "fill": "dash"
            }
          },
          {
            "id": "custom.lineWidth",
            "value": 2
          },
          {
            "id": "unit",
            "value": "kpa"
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "DAY Period Overlay"
        },
        "properties": [
          {
            "id": "color",
            "value": {
              "mode": "fixed",
              "fixedColor": "yellow"
            }
          },
          {
            "id": "custom.drawStyle",
            "value": "line"
          },
          {
            "id": "custom.fillOpacity",
            "value": 15
          },
          {
            "id": "custom.gradientMode",
            "value": "opacity"
          },
          {
            "id": "custom.lineWidth",
            "value": 0
          },
          {
            "id": "custom.axisPlacement",
            "value": "right"
          },
          {
            "id": "custom.axisSoftMax",
            "value": 100
          },
          {
            "id": "custom.axisSoftMin",
            "value": 0
          },
          {
            "id": "hideFrom",
            "value": {
              "tooltip": true,
              "viz": false,
              "legend": true
            }
          },
          {
            "id": "unit",
            "value": "percent"
          }
        ]
      }
    ]
  },
  "pluginVersion": "12.3.1",
  "targets": [
    {
      "format": "time_series",
      "rawSql": "SELECT time AS \"time\", sensor_name AS metric, value FROM measurement_with_metadata WHERE sensor_name IN ('dry_bulb_f', 'wet_bulb_f', 'rh_f', 'vpd_f', 'dry_bulb_b', 'wet_bulb_b', 'rh_b', 'vpd_b') AND time >= $__timeFrom() AND time <= $__timeTo() ORDER BY time, sensor_name",
      "refId": "A"
    },
    {
      "format": "time_series",
      "rawSql": "SELECT \n  timestamp AS \"time\",\n  'Temp Setpoint - Main' AS metric,\n  temperature AS value\nFROM setpoint_history\nWHERE location = 'Flower Room' \n  AND cluster = 'main' \n  AND mode IN ('DAY', 'NIGHT')\n  AND temperature IS NOT NULL\n  AND timestamp >= $__timeFrom()\n  AND timestamp <= $__timeTo()\nORDER BY timestamp",
      "refId": "B",
      "hide": false
    },
    {
      "format": "time_series",
      "rawSql": "SELECT \n  timestamp AS \"time\",\n  'VPD Setpoint - Main' AS metric,\n  vpd AS value\nFROM setpoint_history\nWHERE location = 'Flower Room' \n  AND cluster = 'main' \n  AND mode IN ('DAY', 'NIGHT')\n  AND vpd IS NOT NULL\n  AND timestamp >= $__timeFrom()\n  AND timestamp <= $__timeTo()\nORDER BY timestamp",
      "refId": "C",
      "hide": false
    },
    {
      "format": "time_series",
      "rawSql": "WITH time_points AS (\n  SELECT generate_series($__timeFrom()::timestamp, $__timeTo()::timestamp, INTERVAL '5 minute') AS time\n)\nSELECT \n  tp.time AS \"time\",\n  'DAY Period Overlay' AS metric,\n  CASE \n    WHEN EXISTS (\n      SELECT 1 FROM schedules \n      WHERE location = 'Flower Room' \n        AND cluster = 'main'\n        AND mode = 'DAY'\n        AND enabled = true\n        AND (day_of_week IS NULL OR day_of_week = EXTRACT(DOW FROM tp.time))\n        AND (\n          (start_time <= end_time AND tp.time::time >= start_time AND tp.time::time < end_time)\n          OR (start_time > end_time AND (tp.time::time >= start_time OR tp.time::time < end_time))\n        )\n    ) THEN 100\n    ELSE NULL\n  END AS value\nFROM time_points tp",
      "refId": "D",
      "hide": false
    }
  ],
  "datasource": {
    "type": "grafana-postgresql-datasource",
    "uid": "bf6vebq5ipybke"
  },
  "options": {
    "tooltip": {
      "mode": "multi",
      "sort": "none",
      "hideZeros": false
    },
    "legend": {
      "showLegend": true,
      "displayMode": "list",
      "placement": "bottom",
      "calcs": []
    }
  }
}


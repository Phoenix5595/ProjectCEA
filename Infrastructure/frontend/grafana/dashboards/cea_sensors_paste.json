{
  "title": "CEA Sensors Dashboard",
  "tags": [
    "cea",
    "sensors",
    "timescaledb"
  ],
  "timezone": "browser",
  "schemaVersion": 38,
  "version": 0,
  "refresh": "1s",
  "panels": [
    {
      "id": 1,
      "title": "Temperature - Flower Room Back",
      "type": "timeseries",
      "targets": [
        {
          "datasource": null,
          "rawSql": "SELECT time, sensor_name, value FROM measurement_with_metadata WHERE sensor_name IN ('dry_bulb_b', 'wet_bulb_b') AND time >= $__timeFrom() AND time <= $__timeTo() ORDER BY time, sensor_name",
          "format": "time_series",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 0
      },
      "fieldConfig": {
        "defaults": {
          "unit": "celsius",
          "decimals": 2
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "dry_bulb_b"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Dry Bulb (\u00b0C)"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "wet_bulb_b"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "Wet Bulb (\u00b0C)"
              }
            ]
          }
        ]
      }
    },
    {
      "id": 2,
      "title": "CO2 Levels - All Locations",
      "type": "timeseries",
      "targets": [
        {
          "datasource": null,
          "rawSql": "SELECT time AS \"time\", sensor_name AS metric, value FROM measurement_with_metadata WHERE sensor_name LIKE 'co2_%' AND time >= $__timeFrom() AND time <= $__timeTo() ORDER BY time, sensor_name",
          "format": "time_series",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 0
      },
      "fieldConfig": {
        "defaults": {
          "unit": "ppm",
          "decimals": 0
        }
      }
    },
    {
      "id": 3,
      "title": "RH & VPD (Calculated) - Flower Room Back",
      "type": "timeseries",
      "targets": [
        {
          "datasource": null,
          "rawSql": "SELECT time AS \"time\", sensor_name AS metric, value FROM measurement_with_metadata WHERE sensor_name IN ('rh_b', 'vpd_b') AND time >= $__timeFrom() AND time <= $__timeTo() ORDER BY time, sensor_name",
          "format": "time_series",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 8
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 1
        },
        "overrides": [
          {
            "matcher": {
              "id": "byName",
              "options": "rh_b"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "RH (%)"
              }
            ]
          },
          {
            "matcher": {
              "id": "byName",
              "options": "vpd_b"
            },
            "properties": [
              {
                "id": "displayName",
                "value": "VPD (kPa)"
              },
              {
                "id": "unit",
                "value": "kpa"
              }
            ]
          }
        ]
      }
    },
    {
      "id": 4,
      "title": "Pressure - Flower Room Back",
      "type": "timeseries",
      "targets": [
        {
          "datasource": null,
          "rawSql": "SELECT time AS \"time\", value FROM measurement_with_metadata WHERE sensor_name = 'pressure_b' AND time >= $__timeFrom() AND time <= $__timeTo() ORDER BY time",
          "format": "time_series",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 8
      },
      "fieldConfig": {
        "defaults": {
          "unit": "hpa",
          "decimals": 1,
          "displayName": "Pressure (hPa)"
        }
      }
    },
    {
      "id": 5,
      "title": "Secondary RH (SCD30) - Flower Room Back",
      "type": "timeseries",
      "targets": [
        {
          "datasource": null,
          "rawSql": "SELECT time AS \"time\", value FROM measurement_with_metadata WHERE sensor_name = 'secondary_rh_b' AND time >= $__timeFrom() AND time <= $__timeTo() ORDER BY time",
          "format": "time_series",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 16
      },
      "fieldConfig": {
        "defaults": {
          "unit": "percent",
          "decimals": 1,
          "displayName": "Secondary RH (%)"
        }
      }
    },
    {
      "id": 6,
      "title": "Water Level - All Locations",
      "type": "timeseries",
      "targets": [
        {
          "datasource": null,
          "rawSql": "SELECT time AS \"time\", sensor_name AS metric, value FROM measurement_with_metadata WHERE sensor_name LIKE 'water_level_%' AND time >= $__timeFrom() AND time <= $__timeTo() ORDER BY time, sensor_name",
          "format": "time_series",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 16
      },
      "fieldConfig": {
        "defaults": {
          "unit": "mm",
          "decimals": 0
        }
      }
    },
    {
      "id": 7,
      "title": "Temperature - All Locations (Hourly Avg)",
      "type": "timeseries",
      "description": "Uses continuous aggregate for better performance on longer time ranges",
      "targets": [
        {
          "datasource": null,
          "rawSql": "SELECT time_bucket('1 hour', time) AS \"time\", sensor_name AS metric, AVG(value) AS value FROM measurement_with_metadata WHERE sensor_name IN ('dry_bulb_b', 'wet_bulb_b', 'dry_bulb_f', 'wet_bulb_f') AND time >= $__timeFrom() AND time <= $__timeTo() GROUP BY time_bucket('1 hour', time), sensor_name ORDER BY time, sensor_name",
          "format": "time_series",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 24
      },
      "fieldConfig": {
        "defaults": {
          "unit": "celsius",
          "decimals": 2
        }
      }
    },
    {
      "id": 8,
      "title": "CO2 - All Locations (Hourly Avg)",
      "type": "timeseries",
      "description": "Uses continuous aggregate for better performance",
      "targets": [
        {
          "datasource": null,
          "rawSql": "SELECT time_bucket('1 hour', time) AS \"time\", sensor_name AS metric, AVG(value) AS \"avg_value\", MIN(value) AS \"min_value\", MAX(value) AS \"max_value\" FROM measurement_with_metadata WHERE sensor_name LIKE 'co2_%' AND time >= $__timeFrom() AND time <= $__timeTo() GROUP BY time_bucket('1 hour', time), sensor_name ORDER BY time, sensor_name",
          "format": "time_series",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 24
      },
      "fieldConfig": {
        "defaults": {
          "unit": "ppm",
          "decimals": 0
        }
      }
    },
    {
      "id": 9,
      "title": "Temperature - Using Continuous Aggregate (Hourly)",
      "type": "timeseries",
      "description": "Uses measurement_hourly continuous aggregate for optimal performance (if available)",
      "targets": [
        {
          "datasource": null,
          "rawSql": "SELECT time_bucket('1 hour', time) AS \"time\", sensor_name AS metric, AVG(value) AS \"avg_value\", MIN(value) AS \"min_value\", MAX(value) AS \"max_value\" FROM measurement_with_metadata WHERE sensor_name IN ('dry_bulb_b', 'wet_bulb_b', 'dry_bulb_f', 'wet_bulb_f') AND time >= $__timeFrom() AND time <= $__timeTo() GROUP BY time_bucket('1 hour', time), sensor_name ORDER BY time, sensor_name",
          "format": "time_series",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 32
      },
      "fieldConfig": {
        "defaults": {
          "unit": "celsius",
          "decimals": 2
        }
      }
    },
    {
      "id": 10,
      "title": "All Sensors - Summary Table",
      "type": "table",
      "targets": [
        {
          "datasource": null,
          "rawSql": "SELECT s.name as \"Sensor Name\", s.unit as \"Unit\", r.name as \"Room\", d.name as \"Device\", COUNT(m.sensor_id) as \"Measurement Count\", MAX(m.time) as \"Latest Reading\" FROM sensor s JOIN device d ON s.device_id = d.device_id LEFT JOIN rack rk ON d.rack_id = rk.rack_id LEFT JOIN room r ON rk.room_id = r.room_id LEFT JOIN measurement m ON s.sensor_id = m.sensor_id GROUP BY s.sensor_id, s.name, s.unit, r.name, d.name ORDER BY s.name",
          "format": "table",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 40
      }
    },
    {
      "id": 9,
      "title": "Current Values - Live",
      "type": "stat",
      "description": "Latest sensor readings (updates every 5 seconds)",
      "targets": [
        {
          "datasource": null,
          "rawSql": "SELECT s.name AS \"Sensor\", s.unit AS \"Unit\", r.name AS \"Room\", m.value AS \"Value\", m.time AS \"Time\" FROM measurement m JOIN sensor s ON m.sensor_id = s.sensor_id JOIN device d ON s.device_id = d.device_id LEFT JOIN rack rk ON d.rack_id = rk.rack_id LEFT JOIN room r ON rk.room_id = r.room_id WHERE m.time = (SELECT MAX(time) FROM measurement m2 WHERE m2.sensor_id = m.sensor_id) ORDER BY s.name",
          "format": "table",
          "refId": "A"
        }
      ],
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 48
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [],
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {
                "value": null,
                "color": "green"
              }
            ]
          }
        }
      },
      "options": {
        "reduceOptions": {
          "values": false,
          "calcs": [
            "lastNotNull"
          ],
          "fields": ""
        },
        "orientation": "auto",
        "textMode": "auto"
      }
    }
  ],
  "time": {
    "from": "now-1h",
    "to": "now"
  },
  "timepicker": {},
  "templating": {
    "list": []
  },
  "annotations": {
    "list": []
  },
  "editable": true,
  "graphTooltip": 0,
  "links": []
}
{
  "id": 4,
  "type": "timeseries",
  "title": "Temperature, RH & VPD - Main Graph",
  "gridPos": {
    "x": 4,
    "y": 0,
    "h": 24,
    "w": 20
  },
  "fieldConfig": {
    "defaults": {
      "custom": {
        "drawStyle": "line",
        "lineInterpolation": "linear",
        "barAlignment": 0,
        "barWidthFactor": 0.6,
        "lineWidth": 1,
        "fillOpacity": 0,
        "gradientMode": "none",
        "spanNulls": true,
        "insertNulls": false,
        "showPoints": "auto",
        "showValues": false,
        "pointSize": 5,
        "stacking": {
          "mode": "none",
          "group": "A"
        },
        "axisPlacement": "auto",
        "axisLabel": "",
        "axisColorMode": "series",
        "axisBorderShow": true,
        "scaleDistribution": {
          "type": "linear"
        },
        "axisCenteredZero": false,
        "hideFrom": {
          "tooltip": false,
          "viz": false,
          "legend": false
        },
        "thresholdsStyle": {
          "mode": "off"
        },
        "axisSoftMin": 15,
        "lineStyle": {
          "fill": "solid"
        }
      },
      "color": {
        "mode": "palette-classic"
      },
      "mappings": [],
      "thresholds": {
        "mode": "absolute",
        "steps": [
          {
            "color": "green",
            "value": null
          },
          {
            "color": "red",
            "value": 80
          }
        ]
      },
      "decimals": 2,
      "fieldMinMax": true,
      "unit": "celsius",
      "min": 0
    },
    "overrides": [
      {
        "matcher": {
          "id": "byName",
          "options": "dry_bulb_f"
        },
        "properties": [
          {
            "id": "displayName",
            "value": "Dry Bulb (°C) - Front"
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "wet_bulb_f"
        },
        "properties": [
          {
            "id": "displayName",
            "value": "Wet Bulb (°C) - Front"
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "rh_f"
        },
        "properties": [
          {
            "id": "displayName",
            "value": "RH (%) - Front"
          },
          {
            "id": "unit",
            "value": "percent"
          },
          {
            "id": "decimals",
            "value": 1
          },
          {
            "id": "custom.axisPlacement",
            "value": "right"
          },
          {
            "id": "custom.axisSoftMax",
            "value": 100
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "vpd_f"
        },
        "properties": [
          {
            "id": "displayName",
            "value": "VPD (kPa) - Front"
          },
          {
            "id": "unit",
            "value": "kpa"
          },
          {
            "id": "decimals",
            "value": 2
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "dry_bulb_b"
        },
        "properties": [
          {
            "id": "displayName",
            "value": "Dry Bulb (°C) - Back"
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "wet_bulb_b"
        },
        "properties": [
          {
            "id": "displayName",
            "value": "Wet Bulb (°C) - Back"
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "rh_b"
        },
        "properties": [
          {
            "id": "displayName",
            "value": "RH (%) - Back"
          },
          {
            "id": "unit",
            "value": "percent"
          },
          {
            "id": "decimals",
            "value": 1
          },
          {
            "id": "custom.axisPlacement",
            "value": "right"
          },
          {
            "id": "custom.axisSoftMax",
            "value": 100
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "vpd_b"
        },
        "properties": [
          {
            "id": "displayName",
            "value": "VPD (kPa) - Back"
          },
          {
            "id": "unit",
            "value": "kpa"
          },
          {
            "id": "decimals",
            "value": 2
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "Wet Bulb (°C) - Back"
        },
        "properties": [
          {
            "id": "color",
            "value": {
              "mode": "fixed",
              "fixedColor": "green"
            }
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "Dry Bulb (°C) - Back"
        },
        "properties": [
          {
            "id": "color",
            "value": {
              "mode": "fixed",
              "fixedColor": "orange"
            }
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "VPD Setpoint - Main"
        },
        "properties": [
          {
            "id": "color",
            "value": {
              "mode": "fixed",
              "fixedColor": "blue"
            }
          },
          {
            "id": "custom.lineStyle",
            "value": {
              "dash": [
                0,
                5
              ],
              "fill": "dot"
            }
          },
          {
            "id": "custom.lineWidth",
            "value": 2
          },
          {
            "id": "unit",
            "value": "kpa"
          },
          {
            "id": "custom.lineInterpolation",
            "value": "stepBefore"
          },
          {
            "id": "custom.fillOpacity",
            "value": 0
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "DAY Period Overlay"
        },
        "properties": [
          {
            "id": "color",
            "value": {
              "mode": "fixed",
              "fixedColor": "yellow"
            }
          },
          {
            "id": "custom.drawStyle",
            "value": "line"
          },
          {
            "id": "custom.fillOpacity",
            "value": 15
          },
          {
            "id": "custom.gradientMode",
            "value": "none"
          },
          {
            "id": "custom.lineWidth",
            "value": 0
          },
          {
            "id": "custom.fillBelowTo",
            "value": 0
          },
          {
            "id": "custom.axisPlacement",
            "value": "right"
          },
          {
            "id": "custom.axisSoftMax",
            "value": 100
          },
          {
            "id": "custom.axisSoftMin",
            "value": 0
          },
          {
            "id": "unit",
            "value": "percent"
          },
          {
            "id": "custom.hideFrom",
            "value": {
              "tooltip": true,
              "viz": false,
              "legend": true
            }
          },
          {
            "id": "custom.spanNulls",
            "value": false
          },
          {
            "id": "custom.pointSize",
            "value": 0
          },
          {
            "id": "custom.lineInterpolation",
            "value": "stepAfter"
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "NIGHT Period Overlay"
        },
        "properties": [
          {
            "id": "color",
            "value": {
              "mode": "fixed",
              "fixedColor": "blue"
            }
          },
          {
            "id": "custom.drawStyle",
            "value": "line"
          },
          {
            "id": "custom.fillOpacity",
            "value": 10
          },
          {
            "id": "custom.gradientMode",
            "value": "none"
          },
          {
            "id": "custom.lineWidth",
            "value": 0
          },
          {
            "id": "custom.fillBelowTo",
            "value": 0
          },
          {
            "id": "custom.axisPlacement",
            "value": "right"
          },
          {
            "id": "custom.axisSoftMax",
            "value": 100
          },
          {
            "id": "custom.axisSoftMin",
            "value": 0
          },
          {
            "id": "unit",
            "value": "percent"
          },
          {
            "id": "custom.hideFrom",
            "value": {
              "tooltip": true,
              "viz": false,
              "legend": true
            }
          },
          {
            "id": "custom.spanNulls",
            "value": false
          },
          {
            "id": "custom.pointSize",
            "value": 0
          },
          {
            "id": "custom.lineInterpolation",
            "value": "stepBefore"
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "Heating Setpoint - Main"
        },
        "properties": [
          {
            "id": "custom.lineStyle",
            "value": {
              "fill": "dot",
              "dash": [
                0,
                5
              ]
            }
          },
          {
            "id": "custom.lineWidth",
            "value": 2
          },
          {
            "id": "custom.lineInterpolation",
            "value": "stepBefore"
          },
          {
            "id": "custom.fillOpacity",
            "value": 10
          }
        ]
      },
      {
        "matcher": {
          "id": "byName",
          "options": "Cooling Setpoint - Main"
        },
        "properties": [
          {
            "id": "color",
            "value": {
              "mode": "fixed",
              "fixedColor": "red"
            }
          },
          {
            "id": "custom.lineStyle",
            "value": {
              "fill": "dot",
              "dash": [
                0,
                5
              ]
            }
          },
          {
            "id": "custom.lineWidth",
            "value": 2
          },
          {
            "id": "custom.lineInterpolation",
            "value": "stepBefore"
          },
          {
            "id": "custom.fillOpacity",
            "value": 10
          }
        ]
      }
    ]
  },
  "pluginVersion": "12.3.1",
  "targets": [
    {
      "format": "time_series",
      "rawSql": "SELECT time AS \"time\", sensor_name AS metric, value FROM measurement_with_metadata WHERE sensor_name IN ('dry_bulb_f', 'wet_bulb_f', 'rh_f', 'vpd_f', 'dry_bulb_b', 'wet_bulb_b', 'rh_b', 'vpd_b') AND time >= $__timeFrom() AND time <= $__timeTo() ORDER BY time, sensor_name",
      "refId": "A"
    },
    {
      "format": "time_series",
      "rawSql": "WITH filtered_setpoints AS (\n  SELECT \n    es.timestamp,\n    es.effective_heating_setpoint\n  FROM effective_setpoints es\n  WHERE es.location = 'Flower Room' \n    AND es.cluster = 'main' \n    AND es.effective_heating_setpoint IS NOT NULL\n    AND es.timestamp >= $__timeFrom()\n    AND es.timestamp <= $__timeTo()\n    AND (\n      (es.mode = 'DAY' AND EXISTS (\n        SELECT 1 FROM schedules s\n        WHERE s.location = 'Flower Room'\n          AND s.cluster = 'main'\n          AND s.mode = 'DAY'\n          AND s.enabled = true\n          AND (s.day_of_week IS NULL OR s.day_of_week = EXTRACT(DOW FROM es.timestamp))\n          AND (\n            (s.start_time <= s.end_time AND es.timestamp::time >= s.start_time AND es.timestamp::time < s.end_time)\n            OR (s.start_time > s.end_time AND (es.timestamp::time >= s.start_time OR es.timestamp::time < s.end_time))\n          )\n      ))\n      OR\n      (es.mode = 'NIGHT' AND NOT EXISTS (\n        SELECT 1 FROM schedules s\n        WHERE s.location = 'Flower Room'\n          AND s.cluster = 'main'\n          AND s.mode = 'DAY'\n          AND s.enabled = true\n          AND (s.day_of_week IS NULL OR s.day_of_week = EXTRACT(DOW FROM es.timestamp))\n          AND (\n            (s.start_time <= s.end_time AND es.timestamp::time >= s.start_time AND es.timestamp::time < s.end_time)\n            OR (s.start_time > s.end_time AND (es.timestamp::time >= s.start_time OR es.timestamp::time < s.end_time))\n          )\n      ))\n    )\n),\nlast_setpoint AS (\n  SELECT effective_heating_setpoint, timestamp\n  FROM filtered_setpoints\n  ORDER BY timestamp DESC\n  LIMIT 1\n)\nSELECT timestamp AS \"time\", 'Heating Setpoint - Main' AS metric, effective_heating_setpoint AS value\nFROM filtered_setpoints\nUNION ALL\nSELECT $__timeTo() AS \"time\", 'Heating Setpoint - Main' AS metric, effective_heating_setpoint AS value\nFROM last_setpoint\nWHERE effective_heating_setpoint IS NOT NULL\nORDER BY \"time\"",
      "refId": "B",
      "hide": false
    },
    {
      "format": "time_series",
      "rawSql": "WITH filtered_setpoints AS (\n  SELECT \n    es.timestamp,\n    es.effective_vpd_setpoint\n  FROM effective_setpoints es\n  WHERE es.location = 'Flower Room' \n    AND es.cluster = 'main' \n    AND es.effective_vpd_setpoint IS NOT NULL\n    AND es.timestamp >= $__timeFrom()\n    AND es.timestamp <= $__timeTo()\n    AND (\n      (es.mode = 'DAY' AND EXISTS (\n        SELECT 1 FROM schedules s\n        WHERE s.location = 'Flower Room'\n          AND s.cluster = 'main'\n          AND s.mode = 'DAY'\n          AND s.enabled = true\n          AND (s.day_of_week IS NULL OR s.day_of_week = EXTRACT(DOW FROM es.timestamp))\n          AND (\n            (s.start_time <= s.end_time AND es.timestamp::time >= s.start_time AND es.timestamp::time < s.end_time)\n            OR (s.start_time > s.end_time AND (es.timestamp::time >= s.start_time OR es.timestamp::time < s.end_time))\n          )\n      ))\n      OR\n      (es.mode = 'NIGHT' AND NOT EXISTS (\n        SELECT 1 FROM schedules s\n        WHERE s.location = 'Flower Room'\n          AND s.cluster = 'main'\n          AND s.mode = 'DAY'\n          AND s.enabled = true\n          AND (s.day_of_week IS NULL OR s.day_of_week = EXTRACT(DOW FROM es.timestamp))\n          AND (\n            (s.start_time <= s.end_time AND es.timestamp::time >= s.start_time AND es.timestamp::time < s.end_time)\n            OR (s.start_time > s.end_time AND (es.timestamp::time >= s.start_time OR es.timestamp::time < s.end_time))\n          )\n      ))\n    )\n),\nlast_setpoint AS (\n  SELECT effective_vpd_setpoint, timestamp\n  FROM filtered_setpoints\n  ORDER BY timestamp DESC\n  LIMIT 1\n)\nSELECT timestamp AS \"time\", 'VPD Setpoint - Main' AS metric, effective_vpd_setpoint AS value\nFROM filtered_setpoints\nUNION ALL\nSELECT $__timeTo() AS \"time\", 'VPD Setpoint - Main' AS metric, effective_vpd_setpoint AS value\nFROM last_setpoint\nWHERE effective_vpd_setpoint IS NOT NULL\nORDER BY \"time\"",
      "refId": "C",
      "hide": false
    },
    {
      "format": "time_series",
      "rawSql": "WITH filtered_setpoints AS (\n  SELECT \n    es.timestamp,\n    es.effective_cooling_setpoint\n  FROM effective_setpoints es\n  WHERE es.location = 'Flower Room' \n    AND es.cluster = 'main' \n    AND es.effective_cooling_setpoint IS NOT NULL\n    AND es.timestamp >= $__timeFrom()\n    AND es.timestamp <= $__timeTo()\n    AND (\n      (es.mode = 'DAY' AND EXISTS (\n        SELECT 1 FROM schedules s\n        WHERE s.location = 'Flower Room'\n          AND s.cluster = 'main'\n          AND s.mode = 'DAY'\n          AND s.enabled = true\n          AND (s.day_of_week IS NULL OR s.day_of_week = EXTRACT(DOW FROM es.timestamp))\n          AND (\n            (s.start_time <= s.end_time AND es.timestamp::time >= s.start_time AND es.timestamp::time < s.end_time)\n            OR (s.start_time > s.end_time AND (es.timestamp::time >= s.start_time OR es.timestamp::time < s.end_time))\n          )\n      ))\n      OR\n      (es.mode = 'NIGHT' AND NOT EXISTS (\n        SELECT 1 FROM schedules s\n        WHERE s.location = 'Flower Room'\n          AND s.cluster = 'main'\n          AND s.mode = 'DAY'\n          AND s.enabled = true\n          AND (s.day_of_week IS NULL OR s.day_of_week = EXTRACT(DOW FROM es.timestamp))\n          AND (\n            (s.start_time <= s.end_time AND es.timestamp::time >= s.start_time AND es.timestamp::time < s.end_time)\n            OR (s.start_time > s.end_time AND (es.timestamp::time >= s.start_time OR es.timestamp::time < s.end_time))\n          )\n      ))\n    )\n),\nlast_setpoint AS (\n  SELECT effective_cooling_setpoint, timestamp\n  FROM filtered_setpoints\n  ORDER BY timestamp DESC\n  LIMIT 1\n)\nSELECT timestamp AS \"time\", 'Cooling Setpoint - Main' AS metric, effective_cooling_setpoint AS value\nFROM filtered_setpoints\nUNION ALL\nSELECT $__timeTo() AS \"time\", 'Cooling Setpoint - Main' AS metric, effective_cooling_setpoint AS value\nFROM last_setpoint\nWHERE effective_cooling_setpoint IS NOT NULL\nORDER BY \"time\"",
      "refId": "E",
      "hide": false
    },
    {
      "format": "time_series",
      "rawSql": "WITH time_points AS (\n  SELECT generate_series(\n    date_trunc('minute', $__timeFrom()::timestamptz),\n    $__timeTo()::timestamptz + INTERVAL '1 minute',\n    INTERVAL '1 minute'\n  ) AS utc_time\n),\nlocal_points AS (\n  SELECT\n    utc_time,\n    timezone('America/Toronto', utc_time) AS local_time\n  FROM time_points\n)\nSELECT \n  lp.utc_time AS \"time\",\n  'DAY Period Overlay' AS metric,\n  CASE \n    WHEN EXISTS (\n      SELECT 1 FROM schedules \n      WHERE location = 'Flower Room' \n        AND cluster = 'main'\n        AND mode = 'DAY'\n        AND enabled = true\n        AND device_name LIKE 'light_%'\n        AND (day_of_week IS NULL OR day_of_week = EXTRACT(DOW FROM lp.local_time))\n        AND (\n          (start_time <= end_time AND lp.local_time::time >= start_time AND lp.local_time::time <= end_time)\n          OR (start_time > end_time AND (lp.local_time::time >= start_time OR lp.local_time::time <= end_time))\n        )\n    ) THEN 100.0\n    ELSE NULL\n  END AS value\nFROM local_points lp",
      "refId": "D",
      "hide": false
    },
    {
      "format": "time_series",
      "rawSql": "WITH time_points AS (\n  SELECT generate_series(\n    date_trunc('minute', $__timeFrom()::timestamptz),\n    $__timeTo()::timestamptz + INTERVAL '1 minute',\n    INTERVAL '1 minute'\n  ) AS utc_time\n),\nlocal_points AS (\n  SELECT\n    utc_time,\n    timezone('America/Toronto', utc_time) AS local_time\n  FROM time_points\n)\nSELECT \n  lp.utc_time AS \"time\",\n  'NIGHT Period Overlay' AS metric,\n  CASE \n    WHEN EXISTS (\n      SELECT 1 FROM schedules \n      WHERE location = 'Flower Room' \n        AND cluster = 'main'\n        AND mode = 'NIGHT'\n        AND enabled = true\n        AND device_name LIKE 'light_%'\n        AND (day_of_week IS NULL OR day_of_week = EXTRACT(DOW FROM lp.local_time))\n        AND (\n          (start_time <= end_time AND lp.local_time::time >= start_time AND lp.local_time::time < end_time)\n          OR (start_time > end_time AND (lp.local_time::time >= start_time OR lp.local_time::time < end_time))\n        )\n    ) THEN 100.0\n    ELSE NULL\n  END AS value\nFROM local_points lp",
      "refId": "F",
      "hide": false
    }
  ],
  "datasource": {
    "type": "grafana-postgresql-datasource",
    "uid": "bf6vebq5ipybke"
  },
  "options": {
    "tooltip": {
      "mode": "multi",
      "sort": "none",
      "hideZeros": false
    },
    "legend": {
      "showLegend": true,
      "displayMode": "list",
      "placement": "bottom",
      "calcs": []
    }
  }
}